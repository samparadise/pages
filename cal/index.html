<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Calendar - Samparadise</title>
	<link rel="icon" type="image/png" href="../img/sam-ico.png">
	<link rel="stylesheet" href="../styles.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

	<link href="https://fonts.googleapis.com/css2?family=Cutive+Mono&family=Homemade+Apple&family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">

	<style>
		.calendar-container {
			margin-top: 70px;
			padding: 20px;
			min-height: calc(100vh - 70px);
			background-color: #121212;
		}

		.calendar-wrapper {
			max-width: 1400px;
			margin: 0 auto;
			background: #1a1a1a;
			border-radius: 8px;
			padding: 20px;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
		}

		.view-controls {
			display: flex;
			gap: 10px;
			margin-bottom: 15px;
			flex-wrap: wrap;
			justify-content: center;
		}

		.view-btn {
			padding: 8px 16px;
			background: rgba(149, 225, 211, 0.15);
			color: #95e1d3;
			border: 1px solid rgba(149, 225, 211, 0.3);
			border-radius: 4px;
			cursor: pointer;
			font-size: 0.9rem;
			transition: all 0.3s ease;
		}

		.view-btn:hover {
			background: rgba(149, 225, 211, 0.25);
			border-color: rgba(149, 225, 211, 0.5);
		}

		.view-btn.active {
			background: rgba(149, 225, 211, 0.3);
			border-color: #95e1d3;
			color: #fff;
		}

		.calendar-iframe {
			width: 100%;
			height: 600px;
			border: none;
			border-radius: 4px;
			background: #fff;
		}

		@media (max-width: 768px) {
			.calendar-container {
				padding: 10px;
				margin-top: 60px;
			}

			.calendar-wrapper {
				padding: 10px;
			}

			.calendar-iframe {
				height: 500px;
			}
		}

		@media (max-width: 600px) {
			.calendar-iframe {
				height: 400px;
			}
		}
	</style>
</head>
<body>
	<!-- Bootstrap Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
		<div class="container">
			<a class="navbar-brand" href="../">Samparadise</a>

			<!-- Hamburger Toggle -->
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<!-- Navbar Links -->
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="../">Home</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="calendar-container">
		<div class="calendar-wrapper">
			<div class="view-controls">
				<button class="view-btn" data-mode="MONTH">Month</button>
				<button class="view-btn" data-mode="WEEK">Week</button>
				<button class="view-btn" data-mode="DAY">Day</button>
				<button class="view-btn" data-mode="AGENDA">Agenda</button>
			</div>
			<iframe
				id="calendar-iframe"
				class="calendar-iframe"
				frameborder="0"
				scrolling="no">
			</iframe>
		</div>
	</div>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		(function() {
			const calendarId = 'family02716801312634286908@group.calendar.google.com';
			const timezone = 'America/Chicago';
			const iframe = document.getElementById('calendar-iframe');

			// Parse URL parameters
			function getUrlParams() {
				const params = new URLSearchParams(window.location.search);
				const hash = window.location.hash.substring(1);
				const hashParams = hash ? new URLSearchParams(hash) : new URLSearchParams();

				return {
					mode: params.get('mode') || hashParams.get('mode') || 'MONTH',
					dates: params.get('dates') || hashParams.get('dates') || null,
					date: params.get('date') || hashParams.get('date') || null
				};
			}

			// Build calendar URL
			function buildCalendarUrl(params) {
				let url = `https://calendar.google.com/calendar/embed?src=${encodeURIComponent(calendarId)}&ctz=${encodeURIComponent(timezone)}`;

				if (params.mode) {
					url += `&mode=${params.mode}`;
				}

				if (params.dates) {
					url += `&dates=${params.dates}`;
				} else if (params.date) {
					// Convert single date to date range for week view
					if (params.mode === 'WEEK') {
						const date = new Date(params.date);
						const start = new Date(date);
						start.setDate(date.getDate() - date.getDay()); // Start of week (Sunday)
						const end = new Date(start);
						end.setDate(start.getDate() + 6); // End of week

						const formatDate = (d) => {
							const year = d.getFullYear();
							const month = String(d.getMonth() + 1).padStart(2, '0');
							const day = String(d.getDate()).padStart(2, '0');
							return `${year}${month}${day}`;
						};

						url += `&dates=${formatDate(start)}/${formatDate(end)}`;
					} else if (params.mode === 'DAY') {
						const date = new Date(params.date);
						const formatDate = (d) => {
							const year = d.getFullYear();
							const month = String(d.getMonth() + 1).padStart(2, '0');
							const day = String(d.getDate()).padStart(2, '0');
							return `${year}${month}${day}`;
						};
						url += `&dates=${formatDate(date)}/${formatDate(date)}`;
					}
				}

				return url;
			}

			// Update URL without page reload
			function updateUrl(params) {
				const urlParams = new URLSearchParams();
				if (params.mode && params.mode !== 'MONTH') {
					urlParams.set('mode', params.mode);
				}
				if (params.dates) {
					urlParams.set('dates', params.dates);
				} else if (params.date) {
					urlParams.set('date', params.date);
				}

				const newUrl = urlParams.toString()
					? `${window.location.pathname}?${urlParams.toString()}`
					: window.location.pathname;

				window.history.pushState({}, '', newUrl);
			}

			// Initialize calendar
			function initCalendar() {
				const params = getUrlParams();
				const url = buildCalendarUrl(params);
				iframe.src = url;
				updateActiveButton(params.mode);
			}

			// Update active button
			function updateActiveButton(mode) {
				document.querySelectorAll('.view-btn').forEach(btn => {
					if (btn.dataset.mode === mode) {
						btn.classList.add('active');
					} else {
						btn.classList.remove('active');
					}
				});
			}

			// Handle view button clicks
			document.querySelectorAll('.view-btn').forEach(btn => {
				btn.addEventListener('click', function() {
					const mode = this.dataset.mode;
					const params = getUrlParams();
					params.mode = mode;

					// Clear date/dates when switching views (let calendar show current date)
					params.date = null;
					params.dates = null;

					updateUrl(params);
					initCalendar();
				});
			});

			// Handle browser back/forward
			window.addEventListener('popstate', function() {
				initCalendar();
			});

			// Initialize on page load
			initCalendar();
		})();
	</script>
</body>
</html>

